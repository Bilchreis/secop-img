\documentclass[margin=10pt]{standalone}
\usepackage{color,xcolor}

\usepackage[utf8]{inputenc} 

\input{../praeambel}



\begin{document}
	
	\pgfdeclarelayer{bbackground layer}
	\pgfdeclarelayer{background layer}
	\pgfdeclarelayer{foreground layer}
	\pgfsetlayers{bbackground layer,background layer,main,foreground layer}
	
\footnotesize
	\begin{tikzpicture}[auto, thick, node distance=2cm, >=triangle 45]
	
	\makeGroup{local bluesky environment}{-9.4}{-0.1}{10.7}{4.6} {blue!5}
	\makeGroup{secop-ophyd}{-5}{-0.5}{6.2}{3.8}{yellow!5}
	\makeGroup{mobile se equipment}{2.4}{-0.1}{3}{6.4}{green!5}
	
	\draw 
	
	
	node at (0,0) [object] (client) {SECoP-client\\(frappy)}
	node [object,right = of client,xshift = 2cm] (server) {Sec Node}
	node [object,below= of server,yshift = -0.6cm,xshift = 0.4cm,opacity= 0.2,text opacity = 0](instrument2){blabla}
node [object,below= of server,yshift = -0.8cm,xshift = 0.2cm,opacity=0.6,minimum width = 1.7cm](instrument2){Hardware\\Component}
node [object,below= of server,yshift = -1cm](instrument){\includegraphics[width =1.8cm ]{../img/Hum_cell.png}}
	
	
	node [object,left= of client,xshift = -1cm] (ophyd){Sec Node\\\scriptsize ophyd-async}
	
	node [object,below= of ophyd,xshift = 0.4cm,yshift= -0.3cm,opacity= 0.2,text opacity = 0] (module2){module:a\\\scriptsize ophyd-async}
	node [object,below= of ophyd,xshift = 0.2cm,yshift= -0.5cm,opacity=0.6] (module2){module:a\\\scriptsize ophyd-async}
	node [object,below= of ophyd,xshift =  0cm,yshift = -0.7cm] (module1){module:a\\\scriptsize ophyd-async}
	
	
	
	node [object,left= of ophyd,xshift = -3cm] (bluesky){Bluesky\\run engine} 
	
	node [object,below = of bluesky,yshift = -0.6cm,xshift = 0.4cm,text opacity = 0,opacity=.2](epics) {EPICS-Ophyd\\device}
	node [object,below = of bluesky,yshift = -0.8cm,xshift = 0.2cm,text opacity = 0,opacity=.2](epics) {EPICS-Ophyd\\device}
	node [object,below = of bluesky,yshift = -1cm,opacity=.6](epics) {EPICS-Ophyd\\device}
	
	;
	\draw[<->] (client) -- (server)  node[midway,above,xshift =0.1cm] {\includegraphics[width=1.2cm]{../img/SECoP_Logo/SECoP_logo.eps}} ;
	\draw[<->] (client) -- (server)  node[midway,below,xshift =0.1cm] {\textit{TCP}} ;
	\draw[<->] (client) -- (ophyd);
	\draw[<->] (ophyd) -- (bluesky)	node[midway,above, align=center,xshift = -0.2cm] {Bluesky};
	\draw[<->] (ophyd) -- (bluesky)	node[midway,below, align=center,xshift = -0.2cm] {Interface};
	
	\draw [<->](bluesky)-- (module1);
	
	
	\draw [-] (ophyd) -- (module1);
	
	
	\draw[<->] (module1) -| (client);
	
	\draw[<->,draw = black!30] (bluesky)--(epics);
	\draw[<->] (instrument) -- (server);
	
	
	\begin{pgfonlayer}{bbackground layer}
		\draw[box]	(-10.5,-5.5)rectangle (6.5,2);
	\end{pgfonlayer}
\end{tikzpicture}
	
	
	
\end{document}